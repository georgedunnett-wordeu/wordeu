    }

    function setSecretWord() {
        var word = sanitizeWord(state.myWord);
        if (word.length !== 5) { state.message = t('wordMustBe5'); playSound('error'); haptic('error'); render(); return; }
        if (!hasUniqueLetters(word)) { state.message = t('uniqueLetters'); playSound('error'); haptic('error'); render(); return; }
        
        state.message = '';
        checkWord(word).then(function(isValid) {
            if (!isValid) { state.message = t('notValidWord'); playSound('error'); haptic('error'); render(); return; }
            
            playSound('success');
            haptic('success');
            
            database.ref('games/' + state.gameId + '/players/' + state.playerId).update({
                word: word,
                wordSet: true
            }).then(function() {
                database.ref('games/' + state.gameId).once('value').then(function(snapshot) {
                    var game = snapshot.val();
                    var playerCount = Object.keys(game.players).length;
                    var allWordsSet = Object.values(game.players).every(function(p) { return p.wordSet; });
                    
                    if (playerCount === 2 && allWordsSet && !game.started) {
                        var firstPlayer = Object.keys(game.players)[0];
                        database.ref('games/' + state.gameId).update({ started: true, currentTurn: firstPlayer });
                    }
                });
                state.myWord = '';
                state.message = t('wordSet');
                render();
            });
        });
    }

    function makeGuess() {
        var guess = sanitizeWord(state.currentGuess);
        if (guess.length !== 5) { state.message = t('guessMustBe5'); playSound('error'); haptic('error'); render(); return; }
        if (!hasUniqueLetters(guess)) { state.message = t('uniqueLetters'); playSound('error'); haptic('error'); render(); return; }
        
        state.message = '';
        checkWord(guess).then(function(isValid) {
            if (!isValid) { state.message = t('notValidWord'); playSound('error'); haptic('error'); render(); return; }
            
            var opponentId = Object.keys(state.gameState.players).find(function(id) { return id !== state.playerId; });
            if (!opponentId) return;
            
            var opponentWord = state.gameState.players[opponentId].word;
            var matchCount = 0;
            for (var i = 0; i < guess.length; i++) {
                if (opponentWord.indexOf(guess[i]) !== -1) matchCount++;
            }
            
            var isWin = guess === opponentWord;
            var newGuess = { word: guess, matches: matchCount, timestamp: Date.now() };
            var myGuesses = state.gameState.players[state.playerId].guesses || [];
            myGuesses.push(newGuess);
            
            var updates = {};
            updates['games/' + state.gameId + '/players/' + state.playerId + '/guesses'] = myGuesses;
            
            if (isWin) {
                updates['games/' + state.gameId + '/players/' + state.playerId + '/won'] = true;
                updates['games/' + state.gameId + '/gameOver'] = true;
                state.message = 'üéâ ' + t('youWon');
            } else {
                updates['games/' + state.gameId + '/currentTurn'] = opponentId;
                if (matchCount > 0) { playSound('match'); haptic('medium'); }
                else { playSound('click'); haptic('light'); }
            }
            
            database.ref().update(updates);
            state.currentGuess = '';
            render();
        });
    }

    function toggleLetterState(letter, longPress) {
        var currentStates = state.gameState.players[state.playerId].letterStates || {};
        var currentConfirmed = state.gameState.players[state.playerId].confirmedLetters || [];
        var currentState = currentStates[letter];
        
        if (longPress) {
            if (currentState !== 'included' && currentConfirmed.length >= 5) {
                state.message = t('max5Letters');
                haptic('error');
                render();
                return;
            }
            var newState = currentState === 'included' ? null : 'included';
            currentStates[letter] = newState;
            if (newState === 'included' && currentConfirmed.indexOf(letter) === -1) {
                currentConfirmed.push(letter);
            } else if (newState === null) {
                var idx = currentConfirmed.indexOf(letter);
                if (idx > -1) currentConfirmed.splice(idx, 1);
            }
            haptic('medium');
        } else {
            if (currentState === 'included') {
                currentStates[letter] = null;
                var idx = currentConfirmed.indexOf(letter);
                if (idx > -1) currentConfirmed.splice(idx, 1);
            } else {
                currentStates[letter] = currentState === 'excluded' ? null : 'excluded';
            }
            haptic('light');
        }
        
        database.ref('games/' + state.gameId + '/players/' + state.playerId).update({
            letterStates: currentStates,
            confirmedLetters: currentConfirmed
        });
    }

    // ==================== SINGLE PLAYER ====================
    function startSinglePlayer() {
        var wordList = getWordList();
        var randomWord = wordList[Math.floor(Math.random() * wordList.length)];
        state.singlePlayer = {
            secretWord: randomWord,
            guesses: [],
            letterStates: {},
            confirmedLetters: [],
            gameOver: false,
            won: false
        };
        state.currentGuess = '';
        state.message = '';
        render();
    }

    function makeSinglePlayerGuess() {
        var guess = sanitizeWord(state.currentGuess);
        if (guess.length !== 5) { state.message = t('guessMustBe5'); playSound('error'); haptic('error'); render(); return; }
        if (!hasUniqueLetters(guess)) { state.message = t('uniqueLetters'); playSound('error'); haptic('error'); render(); return; }
        
        state.message = '';
        checkWord(guess).then(function(isValid) {
            if (!isValid) { state.message = t('notValidWord'); playSound('error'); haptic('error'); render(); return; }
            
            var secretWord = state.singlePlayer.secretWord;
            var matchCount = 0;
            for (var i = 0; i < guess.length; i++) {
                if (secretWord.indexOf(guess[i]) !== -1) matchCount++;
            }
            
            var isWin = guess === secretWord;
            state.singlePlayer.guesses.push({ word: guess, matches: matchCount, timestamp: Date.now() });
            state.currentGuess = '';
            
            if (isWin) {
                state.singlePlayer.gameOver = true;
                state.singlePlayer.won = true;
                playSound('win');
                haptic('success');
                showConfetti();
                updateStats(true, state.singlePlayer.guesses.length);
                var gameRecord = {
                    date: Date.now(),
                    opponent: 'Computer',
                    won: true,
                    guesses: state.singlePlayer.guesses.length,
                    myWord: '-',
                    theirWord: secretWord
                };
                saveGameToHistory(gameRecord);
                state.lastGameResult = gameRecord;
            } else {
                if (matchCount > 0) { playSound('match'); haptic('medium'); }
                else { playSound('click'); haptic('light'); }
            }
            render();
        });
    }

    function toggleSinglePlayerLetter(letter, longPress) {
        var sp = state.singlePlayer;
        var currentState = sp.letterStates[letter];
        
        if (longPress) {
            if (currentState !== 'included' && sp.confirmedLetters.length >= 5) {
                state.message = t('max5Letters');
                haptic('error');
                render();
                return;
            }
            var newState = currentState === 'included' ? null : 'included';
            sp.letterStates[letter] = newState;
            if (newState === 'included' && sp.confirmedLetters.indexOf(letter) === -1) {
                sp.confirmedLetters.push(letter);
            } else if (newState === null) {
                var idx = sp.confirmedLetters.indexOf(letter);
                if (idx > -1) sp.confirmedLetters.splice(idx, 1);
            }
            haptic('medium');
        } else {
            if (currentState === 'included') {
                sp.letterStates[letter] = null;
                var idx = sp.confirmedLetters.indexOf(letter);
                if (idx > -1) sp.confirmedLetters.splice(idx, 1);
            } else {
                sp.letterStates[letter] = currentState === 'excluded' ? null : 'excluded';
            }
            haptic('light');
        }
        render();
    }

    function giveUpSinglePlayer() {
        state.singlePlayer.gameOver = true;
        state.singlePlayer.won = false;
        playSound('lose');
        haptic('heavy');
        updateStats(false, 0);
        var gameRecord = {
            date: Date.now(),
            opponent: 'Computer',
            won: false,
            guesses: state.singlePlayer.guesses.length,
            myWord: '-',
            theirWord: state.singlePlayer.secretWord
        };
        saveGameToHistory(gameRecord);
        state.lastGameResult = gameRecord;
        render();
    }

    function shareResult() {
        if (!state.lastGameResult) return;
        var result = state.lastGameResult;
        var text = result.won 
            ? t('shareWon').replace('{n}', result.guesses).replace('{opponent}', result.opponent !== 'Computer' ? t('against') + result.opponent : '')
            : t('shareLost').replace('{n}', result.guesses).replace('{opponent}', result.opponent !== 'Computer' ? t('against') + result.opponent : '');
        text += '\nhttps://5letters.fun';
        
        if (navigator.share) {
            navigator.share({ text: text }).catch(function() {});
        } else {
            navigator.clipboard.writeText(text).then(function() {
                state.message = t('copied');
                render();
            }).catch(function() { prompt(t('copyToShare'), text); });
        }
    }

    // ==================== RENDER ====================
    function render() {
        var app = document.getElementById('app');
        var ALPHABET = getAlphabet();
        
        // Loading state
        if (state.isLoading) {
            app.innerHTML = '<div class="min-h-screen flex items-center justify-center"><div class="text-center text-white"><div class="text-4xl mb-4 loading">üéÆ</div><p class="text-gray-400">' + t('loading') + '</p></div></div>';
            return;
        }
        
        // Build modals
        var modals = '';
        
        // Instructions modal
        if (state.showInstructions) {
            modals += '<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="state.showInstructions=false;render()">' +
                '<div class="bg-white rounded-xl p-6 max-w-md w-full" onclick="event.stopPropagation()">' +
                '<h2 class="text-2xl font-bold mb-4">' + t('howToPlayTitle') + '</h2>' +
                '<ol class="list-decimal list-inside space-y-2 mb-4">' +
                '<li>' + t('rule1') + '</li>' +
                '<li>' + t('rule2') + '</li>' +
                '<li>' + t('rule3') + '</li>' +
                '<li>' + t('rule4') + '</li></ol>' +
                '<p class="font-semibold mb-2">' + t('tips') + '</p>' +
                '<ul class="list-disc list-inside space-y-1 mb-4 text-sm">' +
                '<li>' + t('tip1') + '</li>' +
                '<li>' + t('tip2') + '</li></ul>' +
                '<button onclick="state.showInstructions=false;render()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-bold">' + t('gotIt') + '</button></div></div>';
        }
        
        // Stats modal
        if (state.showStats) {
            var stats = state.stats;
            var winRate = stats.gamesPlayed > 0 ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0;
            var avgGuesses = stats.gamesWon > 0 ? (stats.totalGuesses / stats.gamesWon).toFixed(1) : '-';
            
            modals += '<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="state.showStats=false;render()">' +
                '<div class="bg-white rounded-xl p-6 max-w-md w-full" onclick="event.stopPropagation()">' +
                '<h2 class="text-2xl font-bold mb-4">' + t('stats') + '</h2>' +
                '<div class="grid grid-cols-2 gap-4 mb-4">' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + stats.gamesPlayed + '</div><div class="text-sm text-gray-600">' + t('gamesPlayed') + '</div></div>' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + winRate + '%</div><div class="text-sm text-gray-600">' + t('winRate') + '</div></div>' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + stats.currentStreak + '</div><div class="text-sm text-gray-600">' + t('currentStreak') + '</div></div>' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + stats.bestStreak + '</div><div class="text-sm text-gray-600">' + t('bestStreak') + '</div></div></div>' +
                '<div class="grid grid-cols-2 gap-4 mb-4">' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + avgGuesses + '</div><div class="text-sm text-gray-600">' + t('avgGuesses') + '</div></div>' +
                '<div class="text-center p-3 bg-gray-100 rounded-lg"><div class="text-2xl font-bold">' + (stats.quickestWin || '-') + '</div><div class="text-sm text-gray-600">' + t('quickestWin') + '</div></div></div>' +
                '<button onclick="state.showStats=false;state.showHistory=true;render()" class="w-full bg-gray-200 text-gray-800 py-2 rounded-lg font-semibold mb-2">' + t('viewHistory') + '</button>' +
                '<button onclick="state.showStats=false;render()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-bold">' + t('close') + '</button></div></div>';
        }
        
        // History modal
        if (state.showHistory) {
            var history = loadGameHistory();
            var historyHtml = history.length === 0 ? '<p class="text-gray-500 text-center py-4">' + t('noGamesYet') + '</p>' :
                history.map(function(g) {
                    var date = new Date(g.date).toLocaleDateString();
                    return '<div class="p-3 bg-gray-100 rounded-lg mb-2">' +
                        '<div class="flex justify-between items-center">' +
                        '<span class="font-semibold">' + (g.won ? 'üèÜ' : '‚ùå') + ' ' + (g.opponent === 'Computer' ? t('solo') : t('vs') + ' ' + g.opponent) + '</span>' +
                        '<span class="text-sm text-gray-500">' + date + '</span></div>' +
                        '<div class="text-sm mt-1">' + (g.won ? t('wonIn') + ' ' + g.guesses : t('lost')) + ' ‚Ä¢ ' + t('theirWord') + ' ' + g.theirWord + '</div></div>';
                }).join('');
            
            modals += '<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="state.showHistory=false;render()">' +
                '<div class="bg-white rounded-xl p-6 max-w-md w-full max-h-[80vh] overflow-auto" onclick="event.stopPropagation()">' +
                '<h2 class="text-2xl font-bold mb-4">' + t('gameHistory') + '</h2>' +
                historyHtml +
                '<button onclick="state.showHistory=false;render()" class="w-full bg-purple-600 text-white py-2 rounded-lg font-bold mt-4">' + t('close') + '</button></div></div>';
        }
        
        // Join modal
        var joinModal = '';
        if (state.showJoinModal) {
            joinModal = '<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onclick="state.showJoinModal=false;render()">' +
                '<div class="bg-white rounded-xl p-6 max-w-sm w-full" onclick="event.stopPropagation()">' +
                '<h2 class="text-xl font-bold mb-4">' + t('joinGame') + '</h2>' +
                '<input type="text" id="gameCodeInput" placeholder="' + t('gameCodePlaceholder') + '" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 text-lg uppercase" maxlength="6" onkeyup="state.gameId=this.value">' +
                '<button onclick="joinGame()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold">' + t('joinGame') + '</button>' +
                '<button onclick="state.showJoinModal=false;render()" class="w-full text-gray-500 py-2 mt-2">' + t('cancel') + '</button></div></div>';
        }
        
        // Share modal (after game creation)
        var shareModal = '';
        if (state.showShareModal && state.gameId) {
            var gameUrl = window.location.origin + window.location.pathname + '?game=' + state.gameId;
            shareModal = '<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">' +
                '<div class="bg-white rounded-xl p-6 max-w-sm w-full">' +
                '<h2 class="text-xl font-bold mb-2">' + t('gameCreated') + '</h2>' +
                '<p class="text-gray-600 mb-4">' + t('code') + ': <span class="font-bold text-2xl">' + state.gameId + '</span></p>' +
                '<button onclick="shareGame(\'' + gameUrl + '\')" class="w-full bg-green-500 text-white py-3 rounded-lg font-bold mb-2">' + t('shareInviteLink') + '</button>' +
                '<button onclick="state.showShareModal=false;render()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold">' + t('continue') + '</button></div></div>';
        }
        
        // Language switcher HTML
        var langSwitcher = '<div class="flex justify-center gap-3 mt-4">';
        var langFlags = { en: 'üá¨üáß', de: 'üá©üá™', fr: 'üá´üá∑', es: 'üá™üá∏', it: 'üáÆüáπ' };
        availableLanguages.forEach(function(lang) {
            var flag = langFlags[lang] || 'üåê';
            langSwitcher += '<button onclick="switchLang(\'' + lang + '\')" class="lang-btn text-2xl ' + (currentLang === lang ? 'active' : '') + '" title="' + lang.toUpperCase() + '">' + flag + '</button>';
        });
        langSwitcher += '</div>';
        
        // HOME SCREEN
        if (!state.gameId && !state.singlePlayer) {
            var buttonsHtml = '<button onclick="startSinglePlayer()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-4 rounded-lg transition text-lg shadow-lg mb-3">' + t('playNow') + '</button>' +
                '<div class="flex gap-3">' +
                '<button onclick="state.playerName = document.getElementById(\'playerName\').value; createGame()" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 rounded-lg transition text-sm">' + t('twoPlayerStart') + '</button>' +
                '<button onclick="state.playerName = document.getElementById(\'playerName\').value; if(!state.playerName.trim()) { state.message = t(\'enterName\'); render(); return; } state.showJoinModal = true; render()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-3 rounded-lg transition text-sm">' + t('joinTwoPlayer') + '</button></div>';
            
            app.innerHTML = '<div class="min-h-screen flex flex-col items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full">' +
                '<h1 class="text-4xl font-bold text-gray-800 text-center mb-2 logo-font">' + t('logoText') + '</h1>' +
                '<div class="flex justify-center items-center gap-4 mb-6">' +
                '<button onclick="state.showInstructions = true; render()" class="text-purple-600 hover:text-purple-800 text-sm font-semibold">' + t('howToPlay') + '</button>' +
                '<button onclick="state.showStats = true; render()" class="text-purple-600 hover:text-purple-800 text-sm font-semibold">' + t('yourStats') + '</button>' +
                '<button onclick="toggleSound()" class="text-purple-600 hover:text-purple-800" title="' + (state.soundEnabled ? t('mute') : t('unmute')) + '">' +
                (state.soundEnabled ? '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>' : '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>') +
                '</button></div>' +
                '<input type="text" id="playerName" placeholder="' + t('namePlaceholder') + '" value="' + state.playerName + '" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 text-lg focus:outline-none focus:border-purple-500" onchange="state.playerName=this.value">' +
                buttonsHtml +
                (state.message ? '<div class="mt-4 p-3 bg-purple-100 text-purple-800 rounded-lg text-center">' + state.message + '</div>' : '') +
                langSwitcher +
                '</div><p class="text-gray-500 text-xs mt-4">' + t('copyright') + '</p></div>' + joinModal + shareModal + modals;
            return;
        }
        
        // SINGLE PLAYER GAME
        if (state.singlePlayer) {
            var sp = state.singlePlayer;
            
            if (sp.gameOver) {
                // Game over screen
                var resultHtml = sp.won 
                    ? '<div class="text-green-500 text-6xl mb-4">üéâ</div><h2 class="text-2xl font-bold text-green-600 mb-2">' + t('youWon') + '</h2><p class="text-gray-600">' + t('guessedIn') + ' ' + sp.guesses.length + ' ' + t('tries') + '</p>'
                    : '<div class="text-red-500 text-6xl mb-4">üòî</div><h2 class="text-2xl font-bold text-red-600 mb-2">' + t('gameOver') + '</h2><p class="text-gray-600">' + t('theWordWas') + ': <span class="font-bold">' + sp.secretWord + '</span></p>';
                
                app.innerHTML = '<div class="min-h-screen flex items-center justify-center p-4"><div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center">' +
                    resultHtml +
                    '<div class="mt-6 space-y-2">' +
                    '<button onclick="shareResult()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold">' + t('shareResult') + '</button>' +
                    '<button onclick="startSinglePlayer()" class="w-full bg-purple-600 text-white py-3 rounded-lg font-bold">' + t('playAgain') + '</button>' +
                    '<button onclick="state.singlePlayer=null;render()" class="w-full bg-gray-200 text-gray-800 py-3 rounded-lg font-bold">' + t('home') + '</button></div></div></div>' + modals;
                return;
            }
            
            // Active game
            var guessesHtml = sp.guesses.length === 0 
                ? '<p class="text-gray-400 text-center py-4">' + t('noGuessesYet') + '</p>'
                : sp.guesses.slice().reverse().map(function(g) {
                    var emoji = '';
                    for (var i = 0; i < 5; i++) emoji += g.matches > i ? 'üü©' : '‚¨ú';
                    return '<div class="flex items-center justify-between p-2 bg-gray-100 rounded mb-2 guess-row"><span class="font-mono text-lg tracking-widest">' + g.word + '</span><span>' + emoji + ' ' + g.matches + '</span></div>';
                }).join('');
            
            var alphabetHtml = '<div class="grid gap-1" style="grid-template-columns: repeat(' + Math.min(ALPHABET.length, 9) + ', 1fr)">';
            ALPHABET.forEach(function(letter) {
                var letterState = sp.letterStates[letter];
                var bgColor = letterState === 'excluded' ? 'bg-red-200 text-red-800' : letterState === 'included' ? 'bg-green-200 text-green-800' : 'bg-gray-200';
                alphabetHtml += '<button onclick="toggleSinglePlayerLetter(\'' + letter + '\', false)" oncontextmenu="event.preventDefault();toggleSinglePlayerLetter(\'' + letter + '\', true)" ontouchstart="this.longPressTimer=setTimeout(function(){toggleSinglePlayerLetter(\'' + letter + '\',true)},500)" ontouchend="clearTimeout(this.longPressTimer)" class="w-7 h-7 rounded text-sm font-bold ' + bgColor + '">' + letter + '</button>';
            });
            alphabetHtml += '</div>';
            
            app.innerHTML = '<div class="min-h-screen flex flex-col p-4 max-w-lg mx-auto">' +
                '<div class="bg-white rounded-xl shadow-lg p-4 mb-4">' +
                '<div class="flex justify-between items-center mb-4">' +
                '<button onclick="state.singlePlayer=null;render()" class="text-gray-500 hover:text-gray-700">' + t('backToHome') + '</button>' +
                '<span class="font-bold text-purple-600">' + sp.guesses.length + ' ' + t('guesses') + '</span></div>' +
                '<div class="mb-4">' + alphabetHtml + '</div>' +
                '<div class="flex gap-2"><input type="text" id="guessInput" placeholder="' + t('typeGuessHere') + '" value="' + state.currentGuess + '" maxlength="5" class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-lg text-lg uppercase" oninput="state.currentGuess=this.value.toUpperCase()" onkeypress="if(event.key===\'Enter\')makeSinglePlayerGuess()">' +
                '<button onclick="makeSinglePlayerGuess()" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">' + t('go') + '</button></div>' +
                (state.message ? '<div class="mt-2 p-2 bg-red-100 text-red-700 rounded text-center text-sm">' + state.message + '</div>' : '') +
                '</div>' +
                '<div class="bg-white rounded-xl shadow-lg p-4 flex-1 overflow-auto">' +
                '<h3 class="font-bold text-gray-700 mb-2">' + t('yourGuesses') + '</h3>' +
                guessesHtml +
                '</div>' +
                '<button onclick="giveUpSinglePlayer()" class="mt-4 text-gray-400 hover:text-gray-600 text-sm">' + t('giveUp') + '</button></div>' + modals;
            return;
        }
        
        // TWO-PLAYER GAME (simplified - you can expand this)
        app.innerHTML = '<div class="min-h-screen flex items-center justify-center p-4"><div class="bg-white rounded-xl p-6 text-center">' +
            '<p class="text-gray-600 mb-4">Two-player mode coming soon in this version...</p>' +
            '<button onclick="cancelGame()" class="bg-purple-600 text-white px-6 py-2 rounded-lg">' + t('home') + '</button></div></div>' + modals;
    }

    // ==================== INITIALIZE ====================
    loadAvailableLanguages()
        .then(function() {
            currentLang = getCurrentLang();
            return loadLanguageData(currentLang);
        })
        .then(function() {
            document.title = t('title');
            state.isLoading = false;
            render();
        })
        .catch(function(err) {
            console.error('Init error:', err);
            langData = fallbackLang;
            state.isLoading = false;
            render();
        });
    </script>
</body>
</html>
